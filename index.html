
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Ученики — ФШР / Lichess Rapid + Прогресс за 30 дней</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; }
  h2 { margin: 0 0 16px; text-align:center; }
  .toolbar { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center; margin-bottom:12px; }
  .search, .select { padding:8px 10px; border:1px solid #ccc; border-radius:6px; min-width:220px; background:#fff; }
  .seg { display:inline-flex; border:1px solid #ccc; border-radius:8px; overflow:hidden; }
  .seg-btn { padding:8px 12px; background:#f6f6f6; border:none; cursor:pointer; }
  .seg-btn.active { background:#d96b1c; color:#fff; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:left; }
  th { background:#f6f6f6; cursor:pointer; user-select:none; }
  th.active-col { background:#ffe7d6; }
  .hide { display:none; }
  th.sort-asc::after  { content:' \25B2'; }
  th.sort-desc::after { content:' \25BC'; }
  .delta { font-weight:600; }
  @media(max-width:480px){
    body { padding:12px; }
    th, td { padding:6px; font-size:12px; }
    .seg-btn { padding:6px 8px; }
    .search, .select { min-width:160px; }
  }
</style>
</head>
<body>
  <h2>Ученики — ФШР / Lichess Rapid + Прогресс за 30 дней</h2>
  <div class="toolbar">
    <input id="q" class="search" type="search" placeholder="Поиск по ФИО..." oninput="render()" />
    <select id="coach" class="select" onchange="render()">
      <option value="">Все тренеры</option>
    </select>
    <div class="seg">
      <button id="btnFSHR" class="seg-btn active" onclick="setMode('rt')">ФШР Rapid</button>
      <button id="btnLICH" class="seg-btn" onclick="setMode('lrt')">Lichess Rapid</button>
    </div>
  </div>
  <table id="tab">
    <thead>
      <tr>
        <th>#</th>
        <th data-k="fullName" onclick="sortBy(this)">ФИО</th>
        <th data-k="id"       onclick="sortBy(this)">ID ФШР</th>
        <th data-k="year"     onclick="sortBy(this)">Год рожд.</th>

        <th data-k="rt"             data-col="rt"  onclick="sortBy(this)">ФШР Rapid</th>
        <th data-k="rtDeltaPctNum"  data-col="rt"  onclick="sortBy(this)">Прогресс</th>

        <th data-k="lrt"            data-col="lrt" onclick="sortBy(this)">Lichess Rapid</th>
        <th data-k="lrtDeltaPctNum" data-col="lrt" onclick="sortBy(this)">Прогресс</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  const data = [{"fullName":"Симонов Михей Андреевич","id":"477943","year":"2012","rt":"1501","lichess":"michey1","lrt":"1725","lrtDeltaPctNum":0,"hkey":"lich:michey1","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":0},{"fullName":"Афонин Александр Викторович","id":"103499","year":"2010","rt":"1467","lichess":"student2323","lrt":"1762","lrtDeltaPctNum":-1.564245810055866,"hkey":"lich:student2323","coaches":["Радионов Т.Р."],"rtDeltaPctNum":4.116394606103619},{"fullName":"Распутько Кирилл Анатольевич","id":"353274","year":"2011","rt":"1429","lichess":"kirill_fut","lrt":"1621","lrtDeltaPctNum":0,"hkey":"lich:kirill_fut","coaches":["Радионов Т.Р."],"rtDeltaPctNum":0},{"fullName":"Бажутова Ева Дмитриевна","id":"471018","year":"2017","rt":"1421","lichess":"ktotakaia","lrt":"1808","lrtDeltaPctNum":0,"hkey":"lich:ktotakaia","coaches":["Гутов А.Н."],"rtDeltaPctNum":1.7179670722977811},{"fullName":"Грибков Даниил Петрович","id":"79383","year":"2009","rt":"1408","lichess":"grdaniil","lrt":"1924","lrtDeltaPctNum":2.1231422505307855,"hkey":"lich:grdaniil","coaches":["Радионов Т.Р."],"rtDeltaPctNum":0},{"fullName":"Осипова Елизавета Алексеевна","id":"381655","year":"2011","rt":"1381","lichess":"osipovaliza","lrt":"1954","lrtDeltaPctNum":0,"hkey":"lich:osipovaliza","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":-3.56145251396648},{"fullName":"Леготин Игорь Георгиевич","id":"468075","year":"2013","rt":"1152","lichess":"igorlego","lrt":"1446","lrtDeltaPctNum":-0.6868131868131868,"hkey":"lich:igorlego","coaches":["Радионов Т.Р."],"rtDeltaPctNum":0},{"fullName":"Рубайлов Дмитрий Михайлович","id":"475337","year":"2014","rt":"1072","lichess":"dimshah","lrt":"1404","lrtDeltaPctNum":0,"hkey":"lich:dimshah","coaches":["Радионов Т.Р."],"rtDeltaPctNum":-12.774613506916191},{"fullName":"Павлов Алексей Николаевич","id":"-","year":"2016","rt":"-","lichess":"lechat_2016","lrt":"1164","lrtDeltaPctNum":-5.211726384364821,"hkey":"lich:lechat_2016","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Трощенко Георгий Алексеевич","id":"-","year":"2016","rt":"-","lichess":"goshapur","lrt":"1091","lrtDeltaPctNum":-2.7629233511586455,"hkey":"lich:goshapur","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Мануйлова Дарья Алексеевна","id":"-","year":"2016","rt":"-","lichess":"dasshhaa","lrt":"1903","lrtDeltaPctNum":0.8479067302596714,"hkey":"lich:dasshhaa","coaches":["Радионов Т.Р.","Гутов А.Н."],"rtDeltaPctNum":null},{"fullName":"Лобанов Вячеслав Константинович","id":"-","year":"2016","rt":"-","lichess":"sl5557","lrt":"1186","lrtDeltaPctNum":-0.9189640768588136,"hkey":"lich:sl5557","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Подабашева Елизавета Александровна","id":"-","year":"2015","rt":"-","lichess":"liza1107","lrt":"1566","lrtDeltaPctNum":-2.247191011235955,"hkey":"lich:liza1107","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Зверев Платон Иванович","id":"-","year":"2015","rt":"-","lichess":"platon_korelov-2015","lrt":"1295","lrtDeltaPctNum":-0.30792917628945343,"hkey":"lich:platon_korelov-2015","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Кухнин Михаил Иванович","id":"-","year":"2016","rt":"-","lichess":"","lrt":"-","lrtDeltaPctNum":null,"hkey":"nm:КУХНИН МИХАИЛ ИВАНОВИЧ|2016","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Новикова Марина Сергеевна","id":"-","year":"1987","rt":"-","lichess":"secret_kelpi","lrt":"1271","lrtDeltaPctNum":-0.23547880690737832,"hkey":"lich:secret_kelpi","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Борисов Максим Антонович","id":"-","year":"2016","rt":"-","lichess":"borisovmax","lrt":"1608","lrtDeltaPctNum":-2.3679417122040074,"hkey":"lich:borisovmax","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Первакова Алёна Денисовна","id":"-","year":"2018","rt":"-","lichess":"","lrt":"-","lrtDeltaPctNum":null,"hkey":"nm:ПЕРВАКОВА АЛЁНА ДЕНИСОВНА|2018","coaches":["Гутов А.Н."],"rtDeltaPctNum":null},{"fullName":"Врубель Константин Романович","id":"-","year":"2017","rt":"-","lichess":"","lrt":"-","lrtDeltaPctNum":null,"hkey":"nm:ВРУБЕЛЬ КОНСТАНТИН РОМАНОВИЧ|2017","coaches":["Гутов А.Н."],"rtDeltaPctNum":null},{"fullName":"Марков Андрей Алексеевич","id":"-","year":"2015","rt":"-","lichess":"maa2015","lrt":"1652","lrtDeltaPctNum":0,"hkey":"lich:maa2015","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Г.Давид","id":"-","year":"2018","rt":"-","lichess":"","lrt":"-","lrtDeltaPctNum":null,"hkey":"nm:Г.ДАВИД|2018","coaches":["Радионов Т.Р."],"rtDeltaPctNum":null},{"fullName":"Бондаренко Максим Сергеевич","id":"-","year":"2015","rt":"-","lichess":"maxim_bondarenko","lrt":"1777","lrtDeltaPctNum":2.3028209556706964,"hkey":"lich:maxim_bondarenko","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Фирсов Иван Денисович","id":"-","year":"2017","rt":"-","lichess":"firsovid","lrt":"1709","lrtDeltaPctNum":0.2934272300469483,"hkey":"lich:firsovid","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Зуева Мария Владимировна","id":"-","year":"2016","rt":"-","lichess":"mashazueva2016","lrt":"1390","lrtDeltaPctNum":-1.0676156583629894,"hkey":"lich:mashazueva2016","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Агеенко Федор Ильич","id":"-","year":"2017","rt":"-","lichess":"fedor_ageenko","lrt":"1596","lrtDeltaPctNum":-0.7462686567164178,"hkey":"lich:fedor_ageenko","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Галанц Илья Вячеславович","id":"-","year":"2010","rt":"-","lichess":"niceg0mer4680","lrt":"2048","lrtDeltaPctNum":1.5873015873015872,"hkey":"lich:niceg0mer4680","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Саломатова Екатерина Дмитриевна","id":"-","year":"2016","rt":"-","lichess":"rozovyj_ferz","lrt":"1187","lrtDeltaPctNum":-0.9181969949916527,"hkey":"lich:rozovyj_ferz","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Алибеков Жангир","id":"-","year":"2011","rt":"-","lichess":"anhonestplayer1","lrt":"2175","lrtDeltaPctNum":0,"hkey":"lich:anhonestplayer1","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Пестова Анастасия Сергеевна","id":"-","year":"2015","rt":"-","lichess":"nastya1990","lrt":"1229","lrtDeltaPctNum":-4.580745341614907,"hkey":"lich:nastya1990","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Кошуков Вячеслав Максимович","id":"-","year":"2015","rt":"-","lichess":"slava_0512","lrt":"1384","lrtDeltaPctNum":4.848484848484849,"hkey":"lich:slava_0512","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Оспичев Антон Игоревич","id":"-","year":"2016","rt":"-","lichess":"anton_ospichev","lrt":"1753","lrtDeltaPctNum":6.695069993913573,"hkey":"lich:anton_ospichev","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Днепровский Сергей","id":"-","year":"-","rt":"-","lichess":"dnsergej","lrt":"1215","lrtDeltaPctNum":2.7918781725888326,"hkey":"lich:dnsergej","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Рогалев Виктор","id":"-","year":"-","rt":"-","lichess":"rollcager","lrt":"1185","lrtDeltaPctNum":4.774535809018567,"hkey":"lich:rollcager","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null},{"fullName":"Веремьёв Михаил","id":"-","year":"-","rt":"-","lichess":"cbfutbol","lrt":"2283","lrtDeltaPctNum":-1.0403120936280885,"hkey":"lich:cbfutbol","coaches":["Чеклецов И.Г."],"rtDeltaPctNum":null}];
  let col = 'rt';
  let asc = false;
  let mode = 'rt';

  // список тренеров — из массива coaches, БЕЗ склеек
  function initCoachFilter(){
    const sel = document.getElementById('coach');
    const set = new Set();
    data.forEach(r => (r.coaches||[]).forEach(name => {
      const v = String(name).trim();
      if (v) set.add(v);
    }));
    Array.from(set).sort((a,b)=> a.localeCompare(b, 'ru')).forEach(name => {
      const o = document.createElement('option');
      o.value = name; o.textContent = name;
      sel.appendChild(o);
    });
  }

  function setMode(m){
    mode = m;
    col = m;
    asc = false;

    document.getElementById('btnFSHR').classList.toggle('active', mode==='rt');
    document.getElementById('btnLICH').classList.toggle('active', mode==='lrt');

    document.querySelectorAll('th').forEach(h => h.classList.remove('active-col','sort-asc','sort-desc'));
    const th = document.querySelector('th[data-k="'+mode+'"]');
    if (th) th.classList.add('active-col','sort-desc');

    render();
  }

  function sortBy(th){
    const k = th.getAttribute('data-k');
    if (col === k) { asc = !asc; } else { col = k; asc = false; }
    document.querySelectorAll('th').forEach(h => h.classList.remove('sort-asc','sort-desc','active-col'));
    th.classList.add(asc ? 'sort-asc' : 'sort-desc');
    th.classList.add('active-col');
    render();
  }

  function applyColumnVisibility(){
    const showRt  = (mode === 'rt');
    document.querySelectorAll('th[data-col="rt"]').forEach(th => th.classList.toggle('hide', !showRt));
    document.querySelectorAll('th[data-col="lrt"]').forEach(th => th.classList.toggle('hide', showRt));
    document.querySelectorAll('td[data-col="rt"]').forEach(td => td.classList.toggle('hide', !showRt));
    document.querySelectorAll('td[data-col="lrt"]').forEach(td => td.classList.toggle('hide', showRt));
  }

  function colorForDelta(pct){
    if (pct === null || isNaN(pct)) return '#888';
    const cap = 30;
    const t = Math.max(0, Math.min(Math.abs(pct) / cap, 1));
    if (pct > 0) {
      const s = Math.round(30 + 60 * t);
      const l = 35;
      return 'hsl(135,'+s+'%,'+l+'%)';
    } else if (pct < 0) {
      const s = Math.round(30 + 60 * t);
      const l = 40;
      return 'hsl(0,'+s+'%,'+l+'%)';
    }
    return '#888';
  }
  function fmtDelta(pct){
    if (pct === null || isNaN(pct)) return '—';
    const sign = pct > 0 ? '+' : '';
    return sign + pct.toFixed(1) + '%';
  }

  function render(){
    const q = (document.getElementById('q').value || '').toLowerCase().trim();
    const coach = (document.getElementById('coach').value || '').trim();
    const body = document.querySelector('#tab tbody');
    body.innerHTML = '';

    const filtered = data.filter(r => {
      const byName = !q || String(r.fullName).toLowerCase().includes(q);
      const byCoach = !coach || (r.coaches || []).some(c => String(c).trim() === coach);
      return byName && byCoach;
    });

    filtered.sort((a,b) => {
      const A = a[col] ?? '';
      const B = b[col] ?? '';
      if (col === 'rt' || col === 'lrt' || col === 'rtDeltaPctNum' || col === 'lrtDeltaPctNum') {
        const xA = isNaN(parseFloat(A)) ? (typeof A === 'number' ? A : 0) : parseFloat(A);
        const xB = isNaN(parseFloat(B)) ? (typeof B === 'number' ? B : 0) : parseFloat(B);
        return asc ? (xA - xB) : (xB - xA);
      }
      if (A < B) return asc ? -1 : 1;
      if (A > B) return asc ?  1 : -1;
      return 0;
    });

    filtered.forEach((r, i) => {
      const rtColor  = colorForDelta(r.rtDeltaPctNum);
      const lrtColor = colorForDelta(r.lrtDeltaPctNum);
      const rtProg   = '<span class="delta" style="color:'+rtColor+'">'  + fmtDelta(r.rtDeltaPctNum)  + '</span>';
      const lrtProg  = '<span class="delta" style="color:'+lrtColor+'">' + fmtDelta(r.lrtDeltaPctNum) + '</span>';

      const tr = document.createElement('tr');
      tr.innerHTML =
        '<td>' + (i+1) + '</td>' +
        '<td>' + r.fullName + '</td>' +
        '<td>' + r.id       + '</td>' +
        '<td>' + r.year     + '</td>' +
        '<td data-col="rt">'  + r.rt     + '</td>' +
        '<td data-col="rt">'  + rtProg   + '</td>' +
        '<td data-col="lrt">' + r.lrt    + '</td>' +
        '<td data-col="lrt">' + lrtProg  + '</td>';
      body.appendChild(tr);
    });

    applyColumnVisibility();
  }

  window.onload = function(){
    initCoachFilter();
    setMode('rt');
  };
</script>
</body>
</html>
  